@using System.Linq
@using Forge.CLI.Core.Templates
@using Forge.CLI.Shared.Extensions
@using Forge.CLI.Shared.Helpers
@model TemplateModel
@{
    var projectName = Model.Project.Name;
    var contextName = Model.ContextName;
    var entityName = Model.EntityName;
    var entityCollection = RazorHelper.Pluralize(entityName);

    var name = Model.Name;

    var queryRelationsManyToOne = Model.Entity.Relations.Where(r => r.Value.Type == "many-to-one").AsQueryable();
    var queryRelationsOneToMany = Model.Entity.Relations.Where(r => r.Value.Type == "one-to-many").AsQueryable();

    var referencedNamespaces = new List<string>()
    {
        "BAYSOFT.Abstractions.Core.Domain.Entities.Validations",
        "FluentValidation",
        $"{projectName}.Core.Domain.{contextName}.Aggregates.{entityCollection}.Entities",
    };
}
@foreach (var referencedNamespace in referencedNamespaces.Order().Distinct())
{
<text>using @(referencedNamespace);
</text>
}

namespace @(projectName).Core.Domain.@(contextName).Aggregates.@(entityCollection).Validations.EntityValidations
{
    public sealed class @(entityName)Validator : EntityValidator<@(entityName)>
    {
        public @(entityName)Validator()
        {
@if (Model.Entity.Properties.Any())
{
    foreach (var property in Model.Entity.Properties)
    {
        if (property.Value.Required)
        {
<text>@(RazorHelper.Tab(3))RuleFor(x => x.@(property.Key)).NotNull().WithMessage("'{PropertyName}' cannot be null!");
</text>
            @if(property.Value.Type.ToLower().Equals("string"))
            {
<text>@(RazorHelper.Tab(3))RuleFor(x => x.@(property.Key)).NotEmpty().WithMessage("'{PropertyName}' cannot be empty!");
</text>
            }
        }
<text>@(RazorHelper.Tab(3))RuleFor(x => x.@(property.Key)).MaximumLength(@(property.Value.Length)).WithMessage("'{PropertyName}' must have a maximum of '{MaxLength}' caracters!");
</text>
    }
}
        }
    }
}