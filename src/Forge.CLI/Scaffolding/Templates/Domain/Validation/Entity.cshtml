@using System.Linq
@using Forge.CLI.Core.Templates
@using Forge.CLI.Shared.Extensions
@using static Forge.CLI.Shared.Helpers.ForgeHelper
@model TemplateModel
@{
    var projectName = Model.Project.Name;
    var contextName = Model.ContextName;
    var entityName = Model.EntityName;
    var entityCollection = Pluralize(entityName);

    var name = Model.Name;

    var queryRelationsManyToOne = Model.Entity.Relations.Where(r => r.Value.Type == "many-to-one").AsQueryable();
    var queryRelationsOneToMany = Model.Entity.Relations.Where(r => r.Value.Type == "one-to-many").AsQueryable();

    var referencedNamespaces = new List<string>()
    {
        UsingInCSharp("BAYSOFT.Abstractions.Core.Domain.Entities.Validations"),
        UsingInCSharp("FluentValidation"),
        UsingInCSharp($"{RenderArtifactNamespace("Domain.Entity", Model)}"),
    };
}
@foreach (var referencedNamespace in referencedNamespaces.Order().Distinct())
{
<text>@(referencedNamespace)
</text>
}

namespace @(Model.Namespace)
{
    public @(Model.Project.UseSealedClasses ? "sealed ":"")class @(entityName)Validator : EntityValidator<@(entityName)>
    {
        public @(entityName)Validator()
        {
@if (Model.Entity.Properties.Any())
{
    foreach (var property in Model.Entity.Properties)
    {
        if (property.Value.Required)
        {
<text>@(Tab(3))RuleFor(x => x.@(property.Key)).NotNull().WithMessage("'{PropertyName}' cannot be null!");
</text>
            @if(property.Value.Type.ToLower().Equals("string"))
            {
<text>@(Tab(3))RuleFor(x => x.@(property.Key)).NotEmpty().WithMessage("'{PropertyName}' cannot be empty!");
@(Tab(3))// RuleFor(x => x.Description).MinimumLength(3).WithMessage("'{PropertyName}' must have at least '{MinLength}' caracters!");
</text>
            }
        }
        @if (property.Value.Type.ToLower().Equals("string") && !property.Value.HasMaxLength)
        {
<text>@(Tab(3))RuleFor(x => x.@(property.Key)).MaximumLength(@(property.Value.Length.HasValue ? property.Value.Length : 64)).WithMessage("'{PropertyName}' must have a maximum of '{MaxLength}' caracters!");
</text>
        }
    }
}
        }
    }
}