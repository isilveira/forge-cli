@using System.Linq
@using Forge.CLI.Core.Templates
@using Forge.CLI.Shared.Extensions
@using static Forge.CLI.Shared.Helpers.ForgeHelper
@model TemplateModel
@{
    var projectName = Model.Project.Name;

    var referencedNamespaces = new List<string>()
    {
        UsingInCSharp("Microsoft.Extensions.DependencyInjection"),
    };
    foreach(var c in Model.Project.Contexts)
    {
		foreach (var e in c.Value.Entities)
		{
			referencedNamespaces.Add(UsingInCSharp($"{RenderArtifactNamespace("Domain.Validation.Create", Model, targetContext: c.Key, targetEntity: e.Key)}"));
			referencedNamespaces.Add(UsingInCSharp($"{RenderArtifactNamespace("Domain.Validation.Update", Model, targetContext: c.Key, targetEntity: e.Key)}"));
			referencedNamespaces.Add(UsingInCSharp($"{RenderArtifactNamespace("Domain.Validation.Delete", Model, targetContext: c.Key, targetEntity: e.Key)}"));
			referencedNamespaces.Add(UsingInCSharp($"{RenderArtifactNamespace("Domain.Validation.New", Model, targetContext: c.Key, targetEntity: e.Key)}"));
			referencedNamespaces.Add(UsingInCSharp($"{RenderArtifactNamespace("Domain.Validation.Entity", Model, targetContext: c.Key, targetEntity: e.Key)}"));
		}
    }
}

@foreach (var referencedNamespace in referencedNamespaces.Order().Distinct())
{
<text>@(referencedNamespace)
</text>
}

namespace @(Model.Namespace)
{
	public static class AddValidationsConfigurations
    {
        public static IServiceCollection AddSpecifications(this IServiceCollection services)
		{
			// Add Specifications
			// services.AddTransient<SampleDescriptionAlreadyExistsSpecification>();

			return services;
        }
        public static IServiceCollection AddEntityValidations(this IServiceCollection services)
		{
@foreach(var context in Model.Project.Contexts)
{
<text>@(Tab(3))#region Validators of @(context.Key)
</text>
	@foreach (var entity in context.Value.Entities)
	{
<text>@(Tab(3))services.AddTransient<@(entity.Key)Validator>();
</text>
	}
<text>@(Tab(3))#endregion

</text>
}
			return services;
        }
        public static IServiceCollection AddDomainValidations(this IServiceCollection services)
		{
@foreach (var context in Model.Project.Contexts)
{
<text>@(Tab(3))#region Specifications Validators of @(context.Key)
</text>
	@foreach (var entity in context.Value.Entities)
	{
<text>@(Tab(3))services.AddTransient<Update@(entity.Key)SpecificationsValidator>();
@(Tab(3))services.AddTransient<Create@(entity.Key)SpecificationsValidator>();
@(Tab(3))services.AddTransient<Delete@(entity.Key)SpecificationsValidator>();
</text>
	}
<text>@(Tab(3))#endregion

</text>
}

			return services;
        }
    }
}
