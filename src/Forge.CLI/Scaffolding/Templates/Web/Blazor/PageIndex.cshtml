@using System.Linq
@using Forge.CLI.Core.Templates
@using Forge.CLI.Shared.Extensions
@using static Forge.CLI.Shared.Helpers.ForgeHelper
@model TemplateModel
@{
	var projectName = Model.Project.Name;
	var contextName = Model.ContextName;
	var entityName = Model.EntityName;
	var entityCollection = Pluralize(Model.EntityName);

	var queryRelationsManyToOne = Model.Entity.Relations.Where(r => r.Value.Type == "many-to-one").AsQueryable();
	var queryRelationsOneToMany = Model.Entity.Relations.Where(r => r.Value.Type == "one-to-many").AsQueryable();
	var queryRelationsManyToOneRequired = queryRelationsManyToOne.Where(q=> q.Value.Required).AsQueryable();

    var referencedNamespaces = new List<string>()
	{
		UsingInBlazor($"{RenderArtifactNamespace("Web.Blazor.Table", Model)}"),
    };
}
@foreach (var referencedNamespace in referencedNamespaces.Order().Distinct())
{
<text>@(referencedNamespace)
</text>
}

@foreach(var trail in GetEntityTrails(Model.Project, contextName, Model.Context, entityName, Model.Entity))
{
<text>@@page "@trail"
</text>
}

@@rendermode InteractiveServer

<Table@(entityCollection)@foreach (var relation in queryRelationsManyToOneRequired.ToList())
{
<text>
@(Tab(1))@(relation.Key)Id="@(relation.Key)Id"</text>
}>
</Table@(entityCollection)>

@@code {
@foreach(var relation in queryRelationsManyToOneRequired.ToList())
{
	<text>@(Tab(1))[Parameter] public @(relation.Value.GetTargetIdType())? @(relation.Key)Id { get; set; }
</text>
}
}